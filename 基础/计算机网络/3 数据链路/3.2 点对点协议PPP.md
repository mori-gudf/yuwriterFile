# 3.2 点对点协议PPP

以往：传输可靠数据链路HDLC
当下通用：不保证可靠，PPP协议广泛使用

@toc

## 3.2.1 PPP特点
* ppp作用于用户到isp端
* ppp需满足的需求
  * **简单**，区别于tcp和网际，数据链路层ppp不需要纠错不需要序号不需要控制流量。 
  * **封装成帧**，需要帧定界
  * **透明**：字节填充避免帧定界字符与内容冲突
  * **多**种网络协议：支持上层多种协议如IP IPX
  * 多种类型链路，需要支持底层多种类型的传输链路。光？电？并行？交换？
  * **差错校验** CRC
  * 检测连接**状态**
  * 最大传送单元MTU
  * **网络层**地址**协商**
  * 数据压缩协商
 
* ppp协议的组成
  * 将IP数据报封装成帧的方法
  * 用于建立、配置和测试数据链路的协议==LCP== 
  * 网络控制协议NCP（用于支持不同网络层，IP appletalk等


## 3.2.2 PPP协议帧格式 
![帧]($resource/%E5%B8%A7.png)
* 字段意义
  * 首部
    * F（flag） 帧标识符号，规格是0x7E(01111110)，两个F就是一个空帧
    * A C字段暂无定义，规定为0xFF和0x03
    * 协议字段：**两个字节**，0x0021=**IP协议数据**，0xC021是LCP数据，0x802是网络层的控制数据 
  * 信息：不超过1500字节的可变长度
  * 尾部：用于CRC的FCS
* 字节填充（异步，字符传输）：0x7E转成2字节的0x7D,0x5D
* 0比特填充（同步，比特流传输）：F标识的特点是连续的5个1，通过扫描信息字段。遇到连续1就插入0，填入即可。解析再删除该0
* （两种填充取决于ppp协议使用的传输方式）

## 3.2.3  PPP协议工作状态

工作链路：用户 ASDL拨号进入ISP，建立物理连接，PC向ISP发送LCP(影响PPP参数选择),接着配置网络层，NCP协议给接入的PC分配ip地址。

![用户pc拨号入isp]($resource/%E7%94%A8%E6%88%B7pc%E6%8B%A8%E5%8F%B7%E5%85%A5isp.png)

* 初始与终止：链路静止
* PC调制解调呼叫路由连接：lCP 链路建立，发送帧，协议字段是LCP，协商配置字段
  * 请求
    * 告知最大帧长
    * 鉴别协议
    * 不用 地址和控制字段
  *  响应 
    *  配置确认帧
    * 配置否认帧
    * 配置拒绝帧
* 鉴别状态：只允许传送lcp协议分组，鉴别分组，质量检测分组
  * 成功进入下一阶段
  * 失败转终止
* 网络层协议状态
  * 两端ncp根据网络协议进行转换，ip or other
  * 链路打开状态
  * 终止请求：链路静止 


---
PPP 包含物理和网络