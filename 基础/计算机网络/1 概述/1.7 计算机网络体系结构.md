# 1.7 计算机网络体系结构


## 1.7.1 计算机网络体系结构的形成
* 计算机网络非常复杂，举例说明两台计算机传输文件数据所需考虑的问题，基本要求**有一条数据通路**
  * 发起者必须将数据通信的通路进行==激活==
  * 需要告知网络如何==识别==到是**哪一台**计算机来接收数据
  * 发起通信的计算机必须弄清楚对面是不是**开机**，网络是否==互联==
  * 发起通信的计算机应用程序必须弄清楚，对面的计算机相应应用程序是否已经做好==接收存储文件==的准备
  * 若计算机文件格式不兼容，谁来处理转格式？
  * 差错如何校验（如出现丢，重复，脏数据以及故障）

* 于是出现来==分层==设计网络结构的理念：
  * 互通信的两个计算机系统必须高度协调工作才行，而这种“==协调==”是相当复杂的。为了设计这样复杂的计算机网络，早在最初的ARPANET设计时即提出了分层的方法。“==分层==”可将庞大而复杂的问题
  * 1974年，美国的IBM公司宣布了系统网络体系结构SNA (System NetworkArchitecture)，而后出现了众多不同体系的网络产品。
  * 经济全球化，信息全球化，==不同网络体系无法保证==统一互联。为了使不同体系结构的计算机网络都能互连，国际标准化组织ISO于1977年成立了专门机构研究该问题。不久后推出**开放系统互连基本参考模型** OSI/RM (Open SystemsInterconnection Reference Model)，简称为OSI
  * 然而标准制定周期长，专家缺乏生产实践等原因导致同期蓬勃发展的因特网产物：非国际标准==TCP/IP==称为事实上的==国际标准==

## 1.7.2 协议于划分层次

要求计算机网络有条不紊交换数据，就必须相互遵守一些约定好的规则。


【网络协议】：为进行网络中的数据交换而建立的规则、标准或约定称为网络协议(network protocol)。
  * 由 语法（传递的信息格式与结构）
  * 语义（发出控制信息命令，行为，响应）
  * 同步 （事件处理顺序）构成 

【举例传递文件网络协议】
* 需要三类工作：
  * 发送端应用要确认接收端应用已经做好接收文件的**准备**，以及准备好文件格式统一处理---【==发送模块==】
  * 两个系统的**文件和文件传送命令**可以在两个系统之间交换，所以需要个通信服务模块进行**差错校验与信息拆装**等。上层文件系统或者其它系统都可以使用它。--【==通信服务模块==】
  * 通信模块不关心网络如何接入，只提供可靠的通信服务。所以需要最后一层协助计算机接入网络的处理模块 -- 【==网络接入模块==】
* 协议图示：
![简单协议]($resource/%E7%AE%80%E5%8D%95%E5%8D%8F%E8%AE%AE.png)

【网络协议分层好处】
* 各层独立，无需理会下一层的实现
* 灵活性好，某一层可以技术替换升级。
* 结构可分割，各层可以适配最适合的技术
* 便于实现和维护，子系统拆分独立
* 促进标准化

【基本每层涉及的功能方向】
* 差错控制
* 流量控制
* 分段和重装
* 通道 复用和分用
* 连接的建立和释放

----
## 1.7.3 五层协议的结构体

国际标准osi==实现复杂==，事实标准其实只有最==顶部三层跟国际标准有差异==，底层网络接口还是参照==统一的通信链路==来实现的。所以既要考虑底层网络接口层，又要研究事实标准，本文采用五层体系结构来探索分析网络协议。
![三种协议图]($resource/%E4%B8%89%E7%A7%8D%E5%8D%8F%E8%AE%AE%E5%9B%BE.png)

* 应用层：定义的是**应用进程间**的通信交互规则，诸多协议有http,smtp邮件协议,ftp协议等。我们称这一层数据单元为**报文**。
* 运输层：为两个主机进程的通信提供**通用数据传输**服务。该层提供数据==分用和复用==的功能，【将上一层不同应用数据合并传输，或者将数据分发给上一层某个应用】。
  * 常用 传输控制协议**TCP** (Transmission Control Protocol)——提供面向连接的、可靠的数据传输服务，其数据传输的单位是报文段(segment)。
  * 用户数据报协议 **UDP** (User Datagram Protocol)——提供无连接的、尽最大努力(best-effort)的数据传输服务（不保证数据传输的可靠性），其数据传输的单位是用户数据报。
* 网络层：选择**分组交换网络**上的主机，将上层数据分组**分包传送**。分组也称为IP数据报
* 数据链路层：具体到端与端，端与网络核心交换端之间的双端通信，则是交由链路层处理。
   - 在两个相邻结点之间传送数据时，数据链路层将网络层交下来的**IP数据报组**装成**帧（framing）**，在两个相邻结点间的链路上传送帧（frame）。每一帧包括**数据和必要的控制信息**（如同步信息、地址信息、差错控制等）。
* 物理层：物理媒介中可以传递**光/电**等信号，计算机中的bit数据如何借助物理媒介**传递转译**，这就是物理层的作用。【甚至通信管道的数据复用分用，调制解调等操作】

----

【协议栈】
![协议栈]($resource/%E5%8D%8F%E8%AE%AE%E6%A0%88.png)

## 1.7.4 实体，协议，服务，服务访问点

* 实体：任何可发送或接收信息的硬件或软件进程
* 协议：控制【对等实体】之间（或者多个）的通信规则的合集
  * 在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面一层所提供的服务。
  * 使用本层服务的实体只能看见服务而无法看见下面的协议
  * 对等实体数据称为协议数据单元（**PDU**）

* 服务访问点SAP：系统【相邻的两层实体】进行交互的地方就是服务访问点。即上一层调用下一层提供服务的地方。数据单元为**SDU**

![实体协议服务]($resource/%E5%AE%9E%E4%BD%93%E5%8D%8F%E8%AE%AE%E6%9C%8D%E5%8A%A1.png)

## 1.7.5 TCP/IP体系结构
![4层]($resource/4%E5%B1%82.jpg)
![应用可跨层]($resource/%E5%BA%94%E7%94%A8%E5%8F%AF%E8%B7%A8%E5%B1%82.png)
![沙漏表示]($resource/%E6%B2%99%E6%BC%8F%E8%A1%A8%E7%A4%BA.png)
![分层只看当下层]($resource/%E5%88%86%E5%B1%82%E5%8F%AA%E7%9C%8B%E5%BD%93%E4%B8%8B%E5%B1%82.png)
![cs]($resource/cs.png)

